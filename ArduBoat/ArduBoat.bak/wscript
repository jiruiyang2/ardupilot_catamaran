from waflib import Utils, Build

# Main build function for ArduBoat
# 1) Build the core ArduPilot static library
# 2) Build the SITL boat program

def build(bld):
    # Load the ArduPilot waf helper
    bld.load('ardupilotwaf')

    # 1) Core ArduPilot static library including all common libraries
    bld.ap_stlib(
        name       = 'ap',
        ap_vehicle = 'boat',
        ap_libraries = bld.ap_get_all_libraries(),
    )

    # 2) SITL boat executable for debugging
    bld.ap_program(
        name       = 'catamaran_dbg',
        source     = ['catamaran.cpp', 'mavlink_globals.cpp', 'hal_sitl_instance.cpp'],
        ap_vehicle = 'boat',
        use        = ['sitl_boat'],
    )

# Bind the waf command 'catamaran_dbg' to our build() function
# so that `./waf catamaran_dbg` runs build()
def build_catamaran_dbg(bld):
    build(bld)

setattr(Build.BuildContext, 'catamaran_dbg', build_catamaran_dbg)
